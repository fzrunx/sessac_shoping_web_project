{% extends 'main/base.html' %}
{% load static %}
{% load humanize %} 

{% block main_title %}
<div class="heading_container heading_center">
    <br><br>
    <h1>장바구니</h1>
</div>
{% endblock %}

{% block content %}
    
<div class="cart-container" style="
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border: 1px solid #e5e7eb;
    max-width: 900px;
    margin: 2rem auto;
    padding: 1.5rem;
">

    <!-- 장바구니 테이블 -->
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd;">
                <th style="padding: 12px 8px; text-align: left;">상품명</th>
                <th style="padding: 12px 8px; text-align: center; min-width: 60px;">수량</th>
                <th style="padding: 12px 8px; text-align: right; min-width: 100px;">단가</th>
                <th style="padding: 12px 8px; text-align: right; min-width: 100px;">합계</th>
                <th style="padding: 12px 8px; text-align: center; min-width: 60px;">삭제</th>
            </tr>
        </thead>
        <tbody>
            {% if cart and not cart.is_empty %}
                {% for restaurant, data in grouped_items.items %}
                    <a href="{% url 'restaurants:restaurant_detail' restaurant.pk %}"><td style="padding: 10px 8px;">{{ restaurant.name }}</td></a>

                    {% for item in data.items %}                    
                        <tr style="border-bottom: 1px solid #eee;">
                        
                        <td style="padding: 10px 8px; text-align: center;">
                            <div class="col-2 col-md-2">
                                <img src="{% if item.menu.image %}{{ item.menu.image.url }}{% else %}{% static 'no_image.jpg' %}{% endif %}" class="img-fluid rounded" alt="{{ item.menu.name }}">
                            </div>
                        </td>
                        <td style="padding: 10px 8px; text-align: center;">{{ item.menu.name }}</td>
                        <td style="padding: 10px 8px; text-align: right;">{{ item.menu.price|floatformat:"0"|intcomma }}원</td>
                        <td style="padding: 10px 8px; text-align: center;">
                        <form action="" method="post" class="d-flex align-items-center">
                            {% csrf_token %}
                            <input type="number" name="quantity" class="form-control form-control-sm" value="{{ item.quantity }}" min="1" style="width: 60px;">
                            <button type="submit" class="btn btn-sm btn-outline-secondary ms-2">변경</button>
                            <a href="" class="btn btn-sm btn-outline-danger ms-1">삭제</a>
                        </form>
                        <span class="fw-bold">{{ item.get_item_total|floatformat:"0"|intcomma }}원</span>
                        </td>
                        </tr>
                    {% endfor %}
                <div class="card-footer text-end bg-light fw-bold">
                    {{ restaurant.name }} 소계: {{ data.total|floatformat:"0"|intcomma }}원
                </div>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>

    <!-- 합계 및 버튼 영역 -->
    <div style="margin-top: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <div style="font-weight: 700; font-size: 1.25rem; color: #1e293b;">
            총 합계: {{ cart.get_total_price|floatformat:"0"|intcomma }}원
        </div>
        <div style="display: flex; gap: 0.75rem;">
            <form action="{% url 'orders:cart_clear' %}" method="post" action="">
                {% csrf_token %}
                <button type="submit" style="
                    padding: 0.6rem 1.2rem;
                    border-radius: 6px;
                    border:none;
                    background:#e53e3e;
                    color:white;
                    font-weight: 600;
                    cursor:pointer;
                    transition: background-color 0.3s ease;
                " onmouseover="this.style.background='#c53030'" onmouseout="this.style.background='#e53e3e'">
                    전체 비우기
                </button>
            </form>

            <a href="{% url 'orders:order_api_create' %}" style="
                padding: 0.6rem 1.2rem;
                background:#2563eb;
                color:white;
                border-radius: 6px;
                font-weight: 600;
                text-decoration:none;
                display: flex;
                align-items: center;
                cursor: pointer;
                transition: background-color 0.3s ease;
            " onmouseover="this.style.background='#1e40af'" onmouseout="this.style.background='#2563eb'">
                <i class="fas fa-credit-card" style="margin-right: 0.5rem;"></i> 결제하기
            </a>
        </div>
    </div>

</div>

{% endblock %}