<script>
    // Function to get CSRF token (uncomment in production)
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    document.addEventListener('DOMContentLoaded', function() {
        // Filter buttons logic
        const filterButtons = document.querySelectorAll('.mypage-choose-date-button .btn');

        filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                const filterValue = this.dataset.filter;
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('filter', filterValue);
                window.location.href = currentUrl.toString();
            });
        });

        // Order cancel button logic
        const cancelButtons = document.querySelectorAll('.cancel-order-btn');

        cancelButtons.forEach(button => {
            button.addEventListener('click', function() {
                const orderId = this.dataset.orderId;
                if (confirm('정말로 이 주문을 취소하시겠습니까?')) {
                    fetch(`/orders/cancel/${orderId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            // 'X-CSRFToken': getCookie('csrftoken') // Uncomment in production
                        },
                        body: JSON.stringify({}) // Empty body for POST request
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert(data.message);
                            window.location.reload(); // Reload page to reflect status change
                        } else {
                            alert('주문 취소 실패: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('주문 취소 중 오류가 발생했습니다.');
                    });
                }
            });
        });

    });
</script>